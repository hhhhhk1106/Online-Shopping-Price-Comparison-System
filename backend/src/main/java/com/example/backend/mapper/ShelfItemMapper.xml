<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.backend.mapper.ShelfItemMapper">
    <select id="selectShelfItemPage" resultType="ShelfItem">
        select * from `shelf-item`
    </select>
    <select id="selectShelfItemPageByKeyword" resultType="ShelfItem">
        select * from `shelf-item`
        <where>
            <if test="keyword !=null and keyword !='' ">
               or `name` like CONCAT('%',#{keyword},'%')
            </if>
        </where>
    </select>
    <select id="selectShelfItemPageByMerchantID" resultType="ShelfItem">
        select * from `shelf-item`
        <where>
            merchant_id = #{merchant_id}
        </where>
    </select>

    <resultMap id="ShelfItemResultMap" type="ShelfItem">
        <id property="id" column="id"/>
        <result property="item_id" column="item_id"/>
        <result property="merchant_id" column="merchant_id"/>
        <result property="platform_id" column="platform_id"/>
        <result property="name" column="name"/>
        <result property="description" column="description"/>
        <result property="origin" column="origin"/>
        <result property="production_date" column="production_date"/>
        <association property="platform" column="platform_id" javaType="Platform">
            <id property="id" column="id"/>
            <result property="name" column="platform_name"/>
        </association>
        <association property="merchant" column="merchant_id" javaType="Merchant">
            <id property="id" column="id"/>
            <result property="name" column="merchant_name"/>
        </association>
    </resultMap>
    <select id="selectShelfItemInfoByKeyword" resultMap="ShelfItemResultMap">
        SELECT
        shelf_item.*,
        platform.name AS platform_name,
        merchant.name AS merchant_name
        FROM `shelf-item` AS shelf_item
        LEFT JOIN platform ON shelf_item.platform_id = platform.id
        LEFT JOIN merchant ON shelf_item.merchant_id = merchant.id
        <where>
            <if test="keyword != null and keyword != ''">
                AND shelf_item.`name` LIKE CONCAT('%', #{keyword}, '%')
            </if>
        </where>
    </select>

    <select id="selectShelfItemInfoByID" resultMap="ShelfItemResultMap">
        SELECT
        shelf_item.*,
        platform.name AS platform_name,
        merchant.name AS merchant_name
        FROM `shelf-item` AS shelf_item
        LEFT JOIN platform ON shelf_item.platform_id = platform.id
        LEFT JOIN merchant ON shelf_item.merchant_id = merchant.id
        <where>
            shelf_item.id = #{id}
        </where>
    </select>
</mapper>
